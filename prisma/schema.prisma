generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role { ADMIN LAWYER PARALEGAL CLERK }
enum ThemePreference { LIGHT DARK SYSTEM }
enum FirmRole { OWNER MEMBER }
enum MatterType { CIVIL }
enum MatterSubType { PROPERTY RECOVERY INJUNCTION CONTRACT PARTITION OTHER }
enum CourtType { DISTRICT HIGH_COURT OTHER }
enum MatterStage { DRAFTING FILED SCRUTINY PLEADINGS WS_PENDING EVIDENCE ARGUMENTS JUDGMENT_RESERVED DISPOSED EXECUTION }
enum MatterStatus { ACTIVE STAYED CLOSED }
enum MatterOutcome { WIN LOSS SETTLED WITHDRAWN DISMISSED NA }
enum DeadlineType { LIMITATION WS_DUE COMPLIANCE FILING_OBJECTION EVIDENCE ARGUMENTS OTHER }
enum DeadlineStatus { OPEN DONE MISSED }
enum Priority { LOW MEDIUM HIGH CRITICAL }
enum TaskStatus { TODO IN_PROGRESS DONE BLOCKED }
enum DocumentType { PLAINT WRITTEN_STATEMENT AFFIDAVIT VAKALATNAMA ANNEXURE ORDER JUDGMENT NOTICE EVIDENCE INDEX OTHER }
enum TemplateType { PLAINT NOTICE AFFIDAVIT APPLICATION OTHER }
enum DraftGeneratedBy { AI USER }
enum DraftStatus { DRAFT REVIEWED FINAL }
enum IntakeType { PROPERTY RECOVERY INJUNCTION GENERAL_CIVIL }
enum AuditAction { CREATE UPDATE DELETE VIEW EXPORT LOGIN DOWNLOAD }

model User {
  id              String @id @default(cuid())
  name            String
  email           String @unique
  passwordHash    String
  role            Role @default(LAWYER)
  themePreference ThemePreference @default(SYSTEM)
  memberships     Membership[]
  tasks           Task[] @relation("AssignedTasks")
  documents       Document[]
  intakeForms     IntakeFormSubmission[]
  audits          AuditLog[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
model Firm {
  id String @id @default(cuid())
  name String
  address String?
  memberships Membership[]
  clients Client[]
  matters Matter[]
  templates Template[]
  intakeForms IntakeFormSubmission[]
  audits AuditLog[]
  createdAt DateTime @default(now())
}
model Membership {
  id String @id @default(cuid())
  firmId String
  userId String
  firmRole FirmRole @default(MEMBER)
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  user User @relation(fields:[userId], references:[id], onDelete: Cascade)
  @@unique([firmId,userId])
}
model Client {
  id String @id @default(cuid())
  firmId String
  fullName String
  phone String?
  email String?
  address String?
  notes String?
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  matters Matter[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Matter {
  id String @id @default(cuid())
  firmId String
  clientId String?
  title String
  matterType MatterType @default(CIVIL)
  subType MatterSubType
  courtName String
  courtCity String
  courtType CourtType
  caseNumber String
  cnrNumber String?
  filingDate DateTime?
  stage MatterStage @default(DRAFTING)
  status MatterStatus @default(ACTIVE)
  outcome MatterOutcome @default(NA)
  oppositeParty String?
  oppositeCounsel String?
  judgeName String?
  nextHearingAt DateTime?
  description String
  hearings Hearing[]
  deadlines Deadline[]
  tasks Task[]
  documents Document[]
  drafts Draft[]
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  client Client? @relation(fields:[clientId], references:[id], onDelete: SetNull)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Hearing {
  id String @id @default(cuid())
  matterId String
  hearingAt DateTime
  purpose String
  courtroom String?
  outcomeNotes String?
  nextHearingAt DateTime?
  matter Matter @relation(fields:[matterId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
model Deadline {
  id String @id @default(cuid())
  matterId String
  type DeadlineType
  dueAt DateTime
  title String
  description String?
  status DeadlineStatus @default(OPEN)
  priority Priority @default(MEDIUM)
  matter Matter @relation(fields:[matterId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Task {
  id String @id @default(cuid())
  matterId String?
  assignedToUserId String?
  title String
  description String?
  status TaskStatus @default(TODO)
  dueAt DateTime?
  priority Priority @default(MEDIUM)
  matter Matter? @relation(fields:[matterId], references:[id], onDelete: SetNull)
  assignedToUser User? @relation("AssignedTasks", fields:[assignedToUserId], references:[id], onDelete: SetNull)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Document {
  id String @id @default(cuid())
  matterId String
  uploadedByUserId String
  docType DocumentType
  title String
  filePath String
  mimeType String
  fileSize Int
  tags String[]
  extractedText String?
  matter Matter @relation(fields:[matterId], references:[id], onDelete: Cascade)
  uploadedByUser User @relation(fields:[uploadedByUserId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
model Template {
  id String @id @default(cuid())
  firmId String
  name String
  templateType TemplateType
  content String
  variablesSchema Json
  drafts Draft[]
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Draft {
  id String @id @default(cuid())
  matterId String
  templateId String?
  title String
  content String
  generatedBy DraftGeneratedBy
  status DraftStatus @default(DRAFT)
  matter Matter @relation(fields:[matterId], references:[id], onDelete: Cascade)
  template Template? @relation(fields:[templateId], references:[id], onDelete: SetNull)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model IntakeFormSubmission {
  id String @id @default(cuid())
  firmId String
  createdByUserId String
  intakeType IntakeType
  rawInput Json
  generatedBrief Json
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  createdByUser User @relation(fields:[createdByUserId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
model AuditLog {
  id String @id @default(cuid())
  firmId String
  userId String
  action AuditAction
  entityType String
  entityId String
  metadata Json
  firm Firm @relation(fields:[firmId], references:[id], onDelete: Cascade)
  user User @relation(fields:[userId], references:[id], onDelete: Cascade)
  createdAt DateTime @default(now())
}
